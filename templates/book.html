<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equipment Booking with Loan Calculator</title>
    <style>
        :root {
            --primary: #2e7d32;
            --primary-dark: #1b5e20;
            --secondary: #ff9800;
            --gray-light: #f5f5f5;
            --gray: #9e9e9e;
            --radius: 8px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f9f9f9;
            padding: 20px;
        }
        
        .modal {
            display: block;
            position: relative;
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 0;
            z-index: 1000;
        }
        
        .modal-content {
            padding: 0;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-header h3 {
            color: var(--primary);
            font-size: 1.5rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            flex: 1;
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: var(--radius);
            font-size: 1rem;
        }
        
        textarea.form-control {
            resize: vertical;
        }
        
        .calculator-container {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        
        .calculator-toggle {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calculator-toggle label {
            margin-right: 10px;
            margin-bottom: 0;
        }
        
        .calculator-toggle select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: var(--radius);
        }
        
        .calculator-form {
            display: none;
            background: #f9f9f9;
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 20px;
        }
        
        .calculator-subheader {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .value-display {
            margin-top: 5px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .metrics-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .metric-box {
            flex: 1;
            background: white;
            padding: 15px;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: var(--shadow);
        }
        
        .metric-title {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .metric-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .btn-calculate, .btn-download {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 1rem;
            margin-right: 10px;
            transition: background-color 0.3s;
        }
        
        .btn-calculate:hover, .btn-download:hover {
            background-color: var(--primary-dark);
        }
        
        .schedule-container {
            margin-top: 20px;
            display: none;
        }
        
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        
        .schedule-table th, .schedule-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .schedule-table th {
            background-color: #f5f5f5;
            font-weight: 600;
        }
        
        .tips-container {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .tip-box {
            flex: 1;
            background: #f9f9f9;
            padding: 15px;
            border-radius: var(--radius);
            border-left: 4px solid var(--secondary);
        }
        
        .tip-title {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            font-size: 0.9rem;
            color: #666;
            text-align: center;
        }
        
        .btn-book {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            display: block;
            margin: 30px auto 0;
            transition: background-color 0.3s;
        }
        
        .btn-book:hover {
            background-color: var(--primary-dark);
        }
    </style>
</head>
<body>
    <!-- Booking Modal -->
    <div class="modal" id="bookingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Book Equipment</h3>
                <button class="close-modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <div id="bookingEquipmentInfo" style="margin-bottom: 20px; padding: 15px; background: var(--gray-light); border-radius: var(--radius);">
                    <h3>John Deere Tractor</h3>
                    <p>Model: 5075E | Category: Tractors</p>
                    <p>Daily Rate: â‚¹5,000 | Deposit: â‚¹10,000</p>
                </div>
                
                <form id="bookingForm">
                    <input type="hidden" id="equipmentId">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="startDate">Start Date *</label>
                            <input type="date" id="startDate" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="endDate">End Date *</label>
                            <input type="date" id="endDate" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="bookingNotes">Special Requests (Optional)</label>
                        <textarea id="bookingNotes" class="form-control" rows="3" placeholder="Any special instructions or requests..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <h4>Pricing Summary</h4>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: var(--radius);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Base Price (â‚¹<span id="dailyPrice">5,000</span> Ã— <span id="daysCount">0</span> days)</span>
                                <span>â‚¹<span id="baseTotal">0</span></span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Service Fee</span>
                                <span>â‚¹<span id="serviceFee">0</span></span>
                            </div>
                            <hr style="margin: 10px 0;">
                            <div style="display: flex; justify-content: space-between; font-weight: bold;">
                                <span>Total</span>
                                <span>â‚¹<span id="bookingTotal">0</span></span>
                            </div>
                        </div>
                    </div>
                </form>
                
                <!-- Loan Calculator Section -->
                <div class="calculator-container">
                    <div class="calculator-toggle">
                        <label for="calculatorOption">Financing Option:</label>
                        <select id="calculatorOption">
                            <option value="none">No Financing</option>
                            <option value="calculator">Loan Calculator</option>
                        </select>
                    </div>
                    
                    <div class="calculator-form" id="loanCalculator">
                        <h3 class="calculator-subheader">Equipment Details</h3>
                        
                        <div class="input-group">
                            <label for="equipment_name">Equipment Name</label>
                            <input type="text" id="equipment_name" class="form-control" value="John Deere Tractor" readonly>
                        </div>
                        
                        <div class="input-group">
                            <label for="equipment_price">Equipment Price (â‚¹)</label>
                            <input type="number" id="equipment_price" class="form-control" value="1500000" min="100000" max="2000000" step="50000">
                            <div class="value-display" id="equipment_price_value">â‚¹1,500,000.00</div>
                        </div>
                        
                        <div class="input-group">
                            <label for="equipment_lifespan">Expected Lifespan (years)</label>
                            <input type="number" id="equipment_lifespan" class="form-control" value="10" min="1" max="20">
                            <div class="value-display" id="equipment_lifespan_value">10 years</div>
                        </div>
                        
                        <h3 class="calculator-subheader">Financing Options</h3>
                        
                        <div class="input-group">
                            <label for="down_payment">Down Payment (%)</label>
                            <input type="number" id="down_payment" class="form-control" value="20" min="0" max="100">
                            <div class="value-display" id="down_payment_value">20%</div>
                            <div class="value-display" id="down_payment_amount">Down Payment Amount: â‚¹300,000.00</div>
                        </div>
                        
                        <div class="input-group">
                            <label for="loan_amount">Loan Amount</label>
                            <div class="value-display" id="loan_amount_value">Loan Amount: â‚¹1,200,000.00</div>
                        </div>
                        
                        <div class="input-group">
                            <label for="interest_rate">Annual Interest Rate (%)</label>
                            <input type="number" id="interest_rate" class="form-control" value="8.5" min="1" max="20" step="0.1">
                            <div class="value-display" id="interest_rate_value">8.5%</div>
                        </div>
                        
                        <div class="input-group">
                            <label for="loan_term">Loan Term (years)</label>
                            <input type="number" id="loan_term" class="form-control" value="5" min="1" max="10">
                            <div class="value-display" id="loan_term_value">5 years</div>
                        </div>
                    </div>
                    
                    <div class="calculator-results" id="calculatorResults" style="display: none;">
                        <h3 class="calculator-subheader">EMI Calculation</h3>
                        
                        <div class="metrics-container">
                            <div class="metric-box">
                                <div class="metric-title">EMI</div>
                                <div class="metric-value" id="emi_value">â‚¹24,624.70</div>
                            </div>
                            
                            <div class="metric-box">
                                <div class="metric-title">Total Interest</div>
                                <div class="metric-value" id="total_interest_value">â‚¹277,482.00</div>
                            </div>
                            
                            <div class="metric-box">
                                <div class="metric-title">Total Payment</div>
                                <div class="metric-value" id="total_payment_value">â‚¹1,477,482.00</div>
                            </div>
                        </div>
                        
                        <button id="calculate_btn" class="btn-calculate">Calculate Payment Schedule</button>
                        
                        <div id="schedule_container" class="schedule-container">
                            <h3>Amortization Schedule (First 12 Months)</h3>
                            <table class="schedule-table">
                                <thead>
                                    <tr>
                                        <th>Month</th>
                                        <th>Beginning Balance</th>
                                        <th>EMI</th>
                                        <th>Principal</th>
                                        <th>Interest</th>
                                        <th>Outstanding Balance</th>
                                    </tr>
                                </thead>
                                <tbody id="schedule_body">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                            
                            <button id="download_btn" class="btn-download">Download Full Schedule as CSV</button>
                        </div>
                    </div>
                </div>
                
                <h2 class="calculator-subheader">Financing Tips for Farmers</h2>
                
                <div class="tips-container">
                    <div class="tip-box">
                        <h3 class="tip-title">ðŸ’° Government Schemes</h3>
                        <p>Check for agricultural subsidies and low-interest loan programs offered by the government for farmers.</p>
                    </div>
                    
                    <div class="tip-box">
                        <h3 class="tip-title">ðŸ“ˆ Seasonal Considerations</h3>
                        <p>Time your purchase to align with harvest seasons when cash flow is typically better.</p>
                    </div>
                    
                    <div class="tip-box">
                        <h3 class="tip-title">ðŸ”§ Maintenance Costs</h3>
                        <p>Remember to factor in ongoing maintenance costs which can be 2-5% of equipment value annually.</p>
                    </div>
                </div>
                
                <footer>
                    <p>This calculator is for estimation purposes only. Actual loan terms may vary based on creditworthiness and lender policies.</p>
                </footer>
                
                <button class="btn-book">Book Now</button>
            </div>
        </div>
    </div>

    <script>
        // DOM elements
        const calculatorOption = document.getElementById('calculatorOption');
        const loanCalculator = document.getElementById('loanCalculator');
        const calculatorResults = document.getElementById('calculatorResults');
        const scheduleContainer = document.getElementById('schedule_container');
        
        // Input elements
        const equipmentPrice = document.getElementById('equipment_price');
        const equipmentLifespan = document.getElementById('equipment_lifespan');
        const downPayment = document.getElementById('down_payment');
        const interestRate = document.getElementById('interest_rate');
        const loanTerm = document.getElementById('loan_term');
        
        // Display elements
        const equipmentPriceValue = document.getElementById('equipment_price_value');
        const equipmentLifespanValue = document.getElementById('equipment_lifespan_value');
        const downPaymentValue = document.getElementById('down_payment_value');
        const downPaymentAmount = document.getElementById('down_payment_amount');
        const loanAmountValue = document.getElementById('loan_amount_value');
        const interestRateValue = document.getElementById('interest_rate_value');
        const loanTermValue = document.getElementById('loan_term_value');
        
        // Result elements
        const emiValue = document.getElementById('emi_value');
        const totalInterestValue = document.getElementById('total_interest_value');
        const totalPaymentValue = document.getElementById('total_payment_value');
        const scheduleBody = document.getElementById('schedule_body');
        
        // Booking form elements
        const startDate = document.getElementById('startDate');
        const endDate = document.getElementById('endDate');
        const daysCount = document.getElementById('daysCount');
        const baseTotal = document.getElementById('baseTotal');
        const serviceFee = document.getElementById('serviceFee');
        const bookingTotal = document.getElementById('bookingTotal');
        
        // Set today's date as minimum for date inputs
        const today = new Date().toISOString().split('T')[0];
        startDate.min = today;
        endDate.min = today;
        
        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                minimumFractionDigits: 2
            }).format(amount);
        }
        
        // Update display values when inputs change
        function updateDisplayValues() {
            const price = parseFloat(equipmentPrice.value);
            const dpPercent = parseFloat(downPayment.value);
            const dpAmount = price * (dpPercent / 100);
            const loanAmount = price - dpAmount;
            
            equipmentPriceValue.textContent = formatCurrency(price);
            equipmentLifespanValue.textContent = `${equipmentLifespan.value} years`;
            downPaymentValue.textContent = `${dpPercent}%`;
            downPaymentAmount.textContent = `Down Payment Amount: ${formatCurrency(dpAmount)}`;
            loanAmountValue.textContent = `Loan Amount: ${formatCurrency(loanAmount)}`;
            interestRateValue.textContent = `${interestRate.value}%`;
            loanTermValue.textContent = `${loanTerm.value} years`;
        }
        
        // Calculate EMI
        function calculateEMI() {
            const price = parseFloat(equipmentPrice.value);
            const dpPercent = parseFloat(downPayment.value);
            const dpAmount = price * (dpPercent / 100);
            const loanAmount = price - dpAmount;
            const annualRate = parseFloat(interestRate.value);
            const termYears = parseFloat(loanTerm.value);
            
            const monthlyRate = annualRate / 100 / 12;
            const termMonths = termYears * 12;
            
            // EMI formula: P * r * (1+r)^n / ((1+r)^n - 1)
            const emi = loanAmount * monthlyRate * Math.pow(1 + monthlyRate, termMonths) / 
                        (Math.pow(1 + monthlyRate, termMonths) - 1);
            
            const totalPayment = emi * termMonths;
            const totalInterest = totalPayment - loanAmount;
            
            emiValue.textContent = formatCurrency(emi);
            totalInterestValue.textContent = formatCurrency(totalInterest);
            totalPaymentValue.textContent = formatCurrency(totalPayment);
            
            return { emi, loanAmount, monthlyRate, termMonths };
        }
        
        // Generate amortization schedule
        function generateSchedule() {
            const { emi, loanAmount, monthlyRate, termMonths } = calculateEMI();
            let balance = loanAmount;
            let html = '';
            
            for (let month = 1; month <= Math.min(12, termMonths); month++) {
                const interest = balance * monthlyRate;
                const principal = emi - interest;
                balance -= principal;
                
                html += `
                    <tr>
                        <td>${month}</td>
                        <td>${formatCurrency(balance + principal)}</td>
                        <td>${formatCurrency(emi)}</td>
                        <td>${formatCurrency(principal)}</td>
                        <td>${formatCurrency(interest)}</td>
                        <td>${formatCurrency(Math.max(0, balance))}</td>
                    </tr>
                `;
            }
            
            scheduleBody.innerHTML = html;
            scheduleContainer.style.display = 'block';
        }
        
        // Calculate booking total
        function calculateBookingTotal() {
            if (startDate.value && endDate.value) {
                const start = new Date(startDate.value);
                const end = new Date(endDate.value);
                const diffTime = Math.abs(end - start);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                
                if (diffDays > 0) {
                    const dailyRate = 5000; // Assuming fixed daily rate
                    const base = dailyRate * diffDays;
                    const fee = base * 0.1; // 10% service fee
                    const total = base + fee;
                    
                    daysCount.textContent = diffDays;
                    baseTotal.textContent = base.toLocaleString('en-IN');
                    serviceFee.textContent = fee.toLocaleString('en-IN');
                    bookingTotal.textContent = total.toLocaleString('en-IN');
                }
            }
        }
        
        // Event listeners
        calculatorOption.addEventListener('change', function() {
            if (this.value === 'calculator') {
                loanCalculator.style.display = 'block';
                calculatorResults.style.display = 'block';
                updateDisplayValues();
                calculateEMI();
            } else {
                loanCalculator.style.display = 'none';
                calculatorResults.style.display = 'none';
            }
        });
        
        equipmentPrice.addEventListener('input', updateDisplayValues);
        equipmentLifespan.addEventListener('input', updateDisplayValues);
        downPayment.addEventListener('input', updateDisplayValues);
        interestRate.addEventListener('input', updateDisplayValues);
        loanTerm.addEventListener('input', updateDisplayValues);
        
        document.getElementById('calculate_btn').addEventListener('click', generateSchedule);
        
        startDate.addEventListener('change', calculateBookingTotal);
        endDate.addEventListener('change', calculateBookingTotal);
        
        // Initialize
        updateDisplayValues();
        
        // Download CSV functionality
        document.getElementById('download_btn').addEventListener('click', function() {
            const { emi, loanAmount, monthlyRate, termMonths } = calculateEMI();
            let balance = loanAmount;
            let csvContent = "Month,Beginning Balance,EMI,Principal,Interest,Outstanding Balance\n";
            
            for (let month = 1; month <= termMonths; month++) {
                const interest = balance * monthlyRate;
                const principal = emi - interest;
                balance -= principal;
                
                csvContent += `${month},${(balance + principal).toFixed(2)},${emi.toFixed(2)},${principal.toFixed(2)},${interest.toFixed(2)},${Math.max(0, balance).toFixed(2)}\n`;
            }
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', 'loan_schedule.csv');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        });
        
        // Close modal functionality
        document.querySelector('.close-modal').addEventListener('click', function() {
            document.getElementById('bookingModal').style.display = 'none';
        });
    </script>
</body>
</html>